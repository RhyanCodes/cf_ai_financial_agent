cf_ai_financial_agent

An AI-powered autonomous stock trading agent built on the Cloudflare Developer Platform.

This project demonstrates the use of Workers AI for decision-making and Durable Objects for state management to create a consistent, serverless trading bot.

üèó Architecture & Design Decisions

1. The "Brain": Workers AI (Llama 3.3)

Why: Traditional trading bots rely on rigid algorithmic rules. By using Llama 3.3 via Workers AI, this agent can perform sentiment analysis on unstructured text (news headlines) to make decisions, mimicking a human trader's intuition but at machine speed.

Model: @cf/meta/llama-3.3-70b-instruct-fp8-fast

Pattern: Returns strict JSON for deterministic program execution.

2. The "Broker": Durable Objects

Why: In a serverless environment (like standard Workers), state is ephemeral. A global variable resets on every request.

Challenge: If two trades happen simultaneously, a standard database might suffer from race conditions on the cash balance.

Solution: I used a Durable Object (StockAgent) to enforce strong consistency. The DO acts as a singleton for the user's session, queuing requests to ensure the portfolio balance is never overdrawn, even during high-frequency requests.

3. The "Body": Cloudflare Workers

Why: Provides the HTTP glue between the frontend and the AI/DO components. It handles CORS and routing with minimal latency (0ms cold starts).

üöÄ Prerequisites

Node.js and npm installed.

Wrangler CLI (npm install -g wrangler).

A Cloudflare account with Workers AI enabled.

üõ†Ô∏è Setup & Running Locally

Clone/Create Directory:
```
mkdir cf_ai_financial_agent
cd cf_ai_financial_agent
```

Install Dependencies:
```
npm install
```

Run Locally:
```
wrangler dev
```

Starts the backend at http://localhost:8787.

Frontend:
Open public/index.html in your browser.

Note: The frontend automatically detects if you are running locally. If the backend is not detected, it switches to a Demo Simulation Mode so you can test the UI interaction immediately.

üì¶ Deployment

Deploy Worker:
```
wrangler deploy
```

Note the URL output (e.g., https://cf-ai-financial-agent.your-subdomain.workers.dev).

Deploy Frontend (Pages):
You can deploy the public folder to Cloudflare Pages.
```
npx wrangler pages deploy public
```

Important: Update the API_BASE variable in index.html to your Worker's URL before deploying to production.

üéÆ How to Use

Initialize: The agent starts with $100,000 USD (mock money).

<img width="2669" height="1539" alt="image" src="https://github.com/user-attachments/assets/4275b113-5e2e-4d1b-8e26-d37e2b3846d7" />

Feed News: Type a simulated news headline into the chat.

Example: "Tesla announces record-breaking deliveries for Q4, exceeding all analyst expectations."

Example: "Oil prices plummet as new reserves are discovered."

<img width="2649" height="1559" alt="image" src="https://github.com/user-attachments/assets/3b4b70c7-50db-4712-abc9-3124436673dd" />

Observe:

Reasoning: The Agent explains its thought process (generated by Llama 3).

Action: It executes a BUY or SELL order.

<img width="2665" height="1533" alt="image" src="https://github.com/user-attachments/assets/e468d0db-c79f-4d33-80f7-862d6798a7f3" />

State: The Portfolio updates in real-time.

üß© Key Code Components

src/worker.js: Contains both the Worker router and the StockAgent Durable Object class.

StockAgent.consultAI(): Interacts with the AI binding to generate structured JSON decisions.

StockAgent.executeTrade(): Transactional logic to update the ledger.

‚ùì Troubleshooting

Error: "You need to register a workers.dev subdomain"

If you see this error when running wrangler dev, it is because the AI services require a connection to your Cloudflare account to function.

Fix:

Log in to the Cloudflare Dashboard.

Go to Workers & Pages on the sidebar.

Look for the "Set up subdomain" option on the right.

Choose a unique name (e.g., yourname-dev) and click Save.

Run wrangler dev again.
